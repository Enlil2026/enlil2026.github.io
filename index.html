<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link href="css/video-js.css" rel="stylesheet" />
<title>Mini TV</title>
<style>
body { background: #111; color: white; font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
#sidebar { width: 230px; background: #222; overflow-y: auto; border-right: 1px solid #444; }
.channel { padding: 9px; cursor: pointer; border-bottom: 1px solid #333; font-size: 0.9em; }
.channel:hover { background: #000; }
#player-container { flex-grow: 1; background: #000; }
.video-js { width: 100% !important; height: 100% !important; }
.controls {  padding: 15px; border-bottom: 1px solid #444; }
button {  width: 100%; padding: 10px; cursor: pointer; background: #e50914; color: white; border: 2px; font-weight: bold; }
.button-size {width: 100%px; border-radius: 10:px; background-color: #000;}
</style>
</head>
<body>

<div id="sidebar">
<div class="controls">
<button id="toggle-btn">TURN TV ON</button>

</div>
<a href="https://cash.app/$Enlilanu"target="_blank"><button class="button-size">Donate</button></a>

<div id="channel-list"></div>
</div>

<div id="player-container">
<video id="iptv-player" class="video-js vjs-default-skin" controls preload="auto"></video>
</div>

<!-- 1. Load Video.js Library -->
<script src="js/video.min.js"></script>

<!-- 2. Your App Logic -->
<script>
// Wrap EVERYTHING in this listener to prevent "videojs is not defined"
window.addEventListener('DOMContentLoaded', () => {
const player = videojs('iptv-player');
const btn = document.getElementById('toggle-btn');
const list = document.getElementById('channel-list');
let isOn = false;

const M3U_URL = 'p/playlist.m3u'; 

btn.addEventListener('click', () => {
isOn = !isOn;
if (isOn) {
btn.innerText = "TURN TV OFF";
btn.style.background = "#444";
loadPlaylist();
} else {
location.reload(); 
}
});

async function loadPlaylist() {
try {
const response = await fetch(M3U_URL);
if (!response.ok) throw new Error("File not found");
const data = await response.text();
parseM3U(data);
} catch (err) {
alert("Error: " + err.message + ". Make sure 'playlist.m3u' is in the same folder.");
}
}

function parseM3U(content) {
const lines = content.split('\n');
list.innerHTML = '';
lines.forEach((line, i) => {
if (line.startsWith('#EXTINF:')) {
const name = line.split(',')[1] || "Unknown Channel";
const url = lines[i + 1]?.trim();
if (url && !url.startsWith('#')) {
const div = document.createElement('div');
div.className = 'channel';
div.innerText = name;
div.onclick = () => {
player.src({ type: 'application/x-mpegURL', src: url });
player.play();
};
list.appendChild(div);
}
}
});
}
});
</script>

</body>
</html>
